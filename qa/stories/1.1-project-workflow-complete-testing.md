# Story 1.1: Project Workflow Complete Testing

## Story Metadata
- **Epic**: 1 - Core Project Management
- **Story ID**: 1.1
- **Story Title**: Complete Project Lifecycle Testing
- **Story Slug**: project-workflow-complete-testing
- **Created**: 2025-10-04
- **Owner**: Quinn (Test Architect)
- **Status**: Ready for Test Design

---

## Story Overview

### User Story
**As a** Project Manager
**I want to** reliably manage projects from creation through completion
**So that** I can efficiently staff events, track costs, and deliver successful projects without data loss or errors

### Business Value
- **Revenue Impact**: HIGH - Directly affects billing accuracy and staff payments
- **User Impact**: HIGH - Core workflow used daily by all project managers
- **Risk**: HIGH - Data integrity issues affect business operations
- **Frequency**: DAILY - Multiple projects managed simultaneously

---

## Acceptance Criteria

### AC1: User Authentication & Dashboard Access
**Given** a registered user with valid credentials
**When** they navigate to the login page and enter email/password
**Then** they should be authenticated and redirected to the Projects Dashboard
**And** the dashboard should display accurate project statistics and cards

**Data Variations**:
- Valid credentials → success
- Invalid credentials → error message
- Empty fields → validation error
- Session expired → redirect to login

---

### AC2: Project Creation with Multi-Step Form
**Given** a logged-in project manager on the dashboard
**When** they click "New Project" and complete all required steps
**Then** a new project should be created in the database
**And** the project should appear in the dashboard with correct information
**And** all mandatory fields should be validated before creation

**Required Steps**:
1. Project Info (title, company, manager, dates)
2. Event Details (type, priority, status)
3. Location (venue address, details)
4. Schedule (working hours, schedule type)
5. Staffing (crew count, supervisors, special skills)
6. Advanced (budget, invoice number, color)
7. Review & Save

**Data Variations**:
- All required fields filled → success
- Missing title → validation error
- Missing company → validation error
- Invalid date range (end before start) → validation error
- Missing manager → validation error

---

### AC3: Project Editing and Updates
**Given** an existing project in the system
**When** a user opens the project details and clicks "Edit"
**Then** they should be able to modify project information
**And** changes should persist immediately to the database
**And** the project card should reflect updated information

**Editable Fields**:
- Project title, description
- Venue address, venue details
- Working hours
- Crew count, supervisors
- Budget, invoice number
- Status, priority
- Project color

**Data Variations**:
- Update single field → success
- Update multiple fields → all saved
- Clear optional field → saved as null
- Invalid data → validation prevents save

---

### AC4: Staff Assignment to Projects
**Given** a project with available staff positions
**When** a user navigates to the Staffing tab and adds a staff member
**Then** the staff member should be added to the project
**And** the database should create a project_staff record
**And** the project's staff count should update
**And** conflict detection should warn if staff is double-booked

**Staff Assignment Options**:
- Apply to full project (all dates)
- Apply to specific dates only
- Set daily salary rates
- Set designation/role
- Set initial status (Pending, Confirmed, Hold)

**Data Variations**:
- Add staff with no conflicts → success
- Add staff with date conflict → warning shown, can override
- Add staff to full project → all dates assigned
- Add staff to specific dates → only selected dates assigned
- Remove staff from project → database record deleted

---

### AC5: Staff Status Management
**Given** staff members assigned to a project
**When** a user changes a staff member's status
**Then** the status should update in the database immediately
**And** the staff should move to the appropriate section (Confirmed/Pending/Hold/Rejected)
**And** the project's filled_positions count should update

**Status Transitions**:
- Pending → Confirmed (move to Confirmed Staff list)
- Pending → Rejected (move to Rejected list)
- Confirmed → Hold (move to On Hold list)
- Any status → Remove (delete from project)

**Data Variations**:
- Confirm single staff → success
- Confirm multiple staff → all updated
- Reject applicant → moved to rejected
- Remove confirmed staff → count decrements

---

### AC6: Staff Replacement Functionality
**Given** a confirmed staff member who cannot work
**When** a user initiates staff replacement
**Then** the system should allow selecting a replacement candidate
**And** both original and replacement staff should be tracked
**And** the replacement reason should be recorded
**And** the project staff count should remain accurate

**Replacement Reasons**:
- Sick leave
- Emergency
- No-show
- Other

**Data Variations**:
- Replace with available candidate → success
- Replace with conflicted candidate → warning, can override
- Replace preserves original staff dates → success
- Replacement inherits salary → can be modified

---

### AC7: Payroll Management
**Given** a project with confirmed staff and working dates
**When** a user navigates to the Payroll tab
**Then** the system should display all staff with calculated totals
**And** allow editing individual salary rates
**And** calculate total project payroll accurately
**And** save changes to the database

**Payroll Calculations**:
- Daily rate × working days = staff total
- Sum of all staff totals = project payroll
- Weekend rates (if applicable)
- Overtime rates (if applicable)

**Data Variations**:
- Edit single staff salary → total recalculates
- Save payroll → persists to database
- View payroll without changes → read-only mode
- Missing salary data → validation error

---

### AC8: Document Management
**Given** a project requiring documentation
**When** a user uploads a document or adds an external link
**Then** the document should be uploaded to Supabase storage
**And** document metadata should be saved to the database
**And** documents should be downloadable
**And** documents can be deleted if needed

**Supported Document Types**:
- PDF, Word (doc/docx)
- Excel (xls/xlsx)
- Images (jpg, png, gif)
- External links (URLs)

**Data Variations**:
- Upload valid file → success
- Upload oversized file (>10MB) → error
- Upload invalid file type → error
- Add external link → saved successfully
- Delete document → removed from storage and DB

---

### AC9: Project Export Functionality
**Given** a project with complete information
**When** a user clicks "Export" and selects a format
**Then** the system should generate a downloadable file
**And** the file should contain accurate, up-to-date data
**And** formatting should be clean and professional

**Export Formats**:
- **CSV**: Basic project and staff data
- **Excel**: Multi-sheet with formatting
- **PDF**: Printable project summary

**Data to Include**:
- Project information (title, dates, venue, etc.)
- Staff list with roles and salaries
- Financial summary (budget, payroll, total)
- Documents list (names, types)

**Data Variations**:
- Export CSV → simple format
- Export Excel → formatted sheets
- Export PDF → professional layout
- Export with no staff → shows empty staff section

---

### AC10: Invoice Generation
**Given** a completed or in-progress project
**When** a user generates an invoice
**Then** the system should create a professional PDF invoice
**And** include all project costs (staff payroll + overhead)
**And** save the invoice to project documents
**And** update the database with invoice record

**Invoice Components**:
- Company details (client)
- Project information
- Line items (staff costs breakdown)
- Subtotal, tax (if applicable), total
- Invoice number
- Payment terms
- Due date

**Data Variations**:
- Generate invoice with complete data → success
- Generate with missing invoice number → auto-generate
- Generate multiple times → new version each time
- Download invoice → PDF file downloads

---

### AC11: Project Status Management
**Given** a project in any status
**When** a user changes the project status
**Then** the status should update in the database
**And** the project card should reflect the new status
**And** the project should appear in the correct filter section
**And** optional completion logic should trigger (e.g., lock editing)

**Status Options**:
- Planning
- Confirmed
- In Progress
- Completed
- Cancelled

**Data Variations**:
- Change status → success, card updates
- Mark as Completed → completion date recorded
- Cancel project → status updates, optional warning
- Completed project → optional lock on staff changes

---

### AC12: Search and Filter Projects
**Given** multiple projects in the system
**When** a user uses search or filters
**Then** the project list should update in real-time
**And** only matching projects should be displayed
**And** filters should be combinable (search + status + month)

**Search Capabilities**:
- Search by project title
- Search by company name
- Search by venue

**Filter Options**:
- Status (All, Planning, Confirmed, In Progress, Completed, Cancelled)
- Month selector
- Priority (Low, Medium, High)
- Date range

**Data Variations**:
- Search with results → filtered list
- Search with no results → empty state message
- Combine filters → results match all criteria
- Clear filters → show all projects

---

### AC13: Schedule Conflict Detection
**Given** staff members with existing assignments
**When** a user tries to assign staff to overlapping dates
**Then** the system should detect the conflict
**And** display a warning with conflicting project details
**And** allow the user to override or cancel
**And** log the conflict if overridden

**Conflict Scenarios**:
- Same staff, same dates, different project → warning
- Same staff, partial overlap → warning with date details
- Same staff, no overlap → no warning
- Override conflict → proceed with warning logged

---

### AC14: Responsive Design & Mobile Access
**Given** a user accessing the system on various devices
**When** they view projects on mobile, tablet, or desktop
**Then** the interface should adapt to the screen size
**And** all functionality should remain accessible
**And** touch interactions should work on mobile/tablet

**Breakpoints**:
- Mobile: < 640px
- Tablet: 640px - 1024px
- Desktop: > 1024px

**Responsive Elements**:
- Project cards (stack vertically on mobile)
- Forms (full-width on mobile)
- Dialogs (full-screen on mobile)
- Tables (horizontal scroll on mobile)
- Buttons (touch-friendly size)

---

### AC15: Error Handling & Data Integrity
**Given** various error conditions
**When** errors occur during operations
**Then** the system should handle them gracefully
**And** display user-friendly error messages
**And** preserve user data (no data loss)
**And** log errors for debugging

**Error Scenarios**:
- Database connection failure → error message, retry option
- Validation errors → inline field errors
- File upload failure → error toast, preserve form
- Network timeout → loading indicator, timeout message
- Duplicate submission → prevent with loading state

---

## Out of Scope

The following are **NOT** included in this story:
- Multi-language support (future enhancement)
- Advanced analytics/reporting dashboards (separate epic)
- Email notifications (separate story)
- Mobile app (separate epic)
- Integration with external payroll systems (future)
- Automated project scheduling/optimization (future)

---

## Dependencies

- Supabase database with tables:
  - `projects`
  - `project_staff`
  - `candidates`
  - `companies`
  - `users`
  - `project_documents`
- Supabase storage bucket: `project-documents`
- React components:
  - `ProjectsPageRedesign.tsx`
  - `EditProjectDialogStepped.tsx`
  - `StaffingTab.tsx`
  - `DocumentsTab.tsx`
  - `PayrollManager.tsx`

---

## Success Metrics

### Functional Metrics
- 100% of AC scenarios pass testing
- 0 critical bugs (P0) in production
- < 2 P1 bugs post-release

### Performance Metrics
- Project creation: < 2 seconds
- Dashboard load: < 1.5 seconds
- Export generation: < 5 seconds
- File upload (5MB): < 10 seconds

### User Experience Metrics
- Form validation: Instant feedback (< 100ms)
- Status updates: Optimistic UI with < 500ms persistence
- Search results: Real-time filtering with debounce (300ms)

---

## Technical Notes

### Database Schema Requirements
- Projects table must have all required columns
- Foreign key relationships properly configured
- Indexes on frequently queried fields (project_id, date ranges)
- Proper constraints (status enum, date validation)

### File Upload Constraints
- Max file size: 10MB
- Allowed types: PDF, DOC, DOCX, XLS, XLSX, JPG, PNG, GIF
- Virus scanning (if available)
- Storage quota monitoring

### Business Rules
- A project must have at least 1 confirmed staff before completion (optional)
- Payroll must be calculated before invoice generation
- Deleted projects should be soft-deleted (optional, not hard-deleted)
- Audit trail for project changes (optional)

---

## Questions & Assumptions

### Questions
1. Should completed projects be editable? (Assume: Yes, with audit trail)
2. Should we prevent overlapping staff assignments? (Assume: Warn but allow override)
3. What happens to documents when project is deleted? (Assume: Soft delete preserves documents)
4. Is there a maximum number of staff per project? (Assume: No limit, validated by crew_count)

### Assumptions
- Users have stable internet connection
- Browser supports modern JavaScript (ES6+)
- Users have permission to manage all projects (role-based access is separate story)
- Currency is consistent (no multi-currency support yet)

---

## Reference Documents

- [User Journey Map](../user-journeys/project-workflow-scenarios.md)
- [Test Levels Framework](../frameworks/test-levels-framework.md)
- [Test Priorities Matrix](../frameworks/test-priorities-matrix.md)

---

## Story Status

- [ ] Story defined and reviewed
- [ ] Acceptance criteria validated
- [ ] Test design created
- [ ] Test scenarios written
- [ ] Automated tests implemented
- [ ] Manual test guide created
- [ ] User guide with screenshots created
- [ ] Story tested and approved
- [ ] Story deployed to production

---

**Story Version:** 1.0
**Last Updated:** 2025-10-04
**Next Step:** Create test design document using `/test-design` task
