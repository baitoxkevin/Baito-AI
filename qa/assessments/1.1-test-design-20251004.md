# Test Design: Story 1.1 - Project Workflow Complete Testing

Date: 2025-10-04
Designer: Quinn (Test Architect)
Story: Epic 1, Story 1.1

---

## Test Strategy Overview

- **Total test scenarios**: 89
- **Unit tests**: 28 (31%)
- **Integration tests**: 41 (46%)
- **E2E tests**: 20 (23%)
- **Priority distribution**:
  - P0: 35 scenarios (39%)
  - P1: 32 scenarios (36%)
  - P2: 18 scenarios (20%)
  - P3: 4 scenarios (5%)

### Strategy Rationale
This test strategy follows the "test pyramid" approach with heavy emphasis on integration tests due to the database-driven nature of the application. E2E tests focus on critical user journeys and revenue-impacting workflows.

---

## Test Scenarios by Acceptance Criteria

### AC1: User Authentication & Dashboard Access

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 1.1-UNIT-001 | Unit | P1 | Validate email format using validateEmail() | Pure validation logic |
| 1.1-UNIT-002 | Unit | P1 | Validate password meets minimum requirements | Pure validation logic |
| 1.1-INT-001 | Integration | P0 | Login with valid credentials ‚Üí session created | Authentication is P0, requires DB |
| 1.1-INT-002 | Integration | P0 | Login with invalid credentials ‚Üí error returned | Security validation, DB check |
| 1.1-INT-003 | Integration | P0 | Session persists across page refreshes | Auth state management |
| 1.1-INT-004 | Integration | P1 | Logout clears session and redirects to login | Auth flow completion |
| 1.1-E2E-001 | E2E | P0 | User logs in and sees dashboard with projects | Critical auth + dashboard journey |
| 1.1-E2E-002 | E2E | P1 | Invalid login shows error, allows retry | Error handling UX |

**Coverage**: 8 tests (1 AC, multiple data variations)

---

### AC2: Project Creation with Multi-Step Form

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 1.1-UNIT-003 | Unit | P0 | Validate project title is required | Form validation logic |
| 1.1-UNIT-004 | Unit | P0 | Validate company_id is required | Form validation logic |
| 1.1-UNIT-005 | Unit | P0 | Validate manager_id is required | Form validation logic |
| 1.1-UNIT-006 | Unit | P0 | Validate end_date is after start_date | Date comparison logic |
| 1.1-UNIT-007 | Unit | P1 | Format date display as "MMM DD, YYYY" | Formatter utility |
| 1.1-INT-005 | Integration | P0 | Create project saves to projects table | Core DB operation |
| 1.1-INT-006 | Integration | P0 | Created project has correct foreign keys | Data integrity |
| 1.1-INT-007 | Integration | P0 | Form submission fails if required fields missing | Validation + DB |
| 1.1-INT-008 | Integration | P1 | Multi-step form preserves data between steps | State management |
| 1.1-INT-009 | Integration | P1 | Created project returns with auto-generated ID | DB auto-increment |
| 1.1-INT-010 | Integration | P2 | Optional fields (description, budget) save as null when empty | Optional field handling |
| 1.1-E2E-003 | E2E | P0 | Complete 7-step project creation ‚Üí project appears on dashboard | Full creation journey |
| 1.1-E2E-004 | E2E | P1 | Form shows validation errors on submit with missing data | Validation UX |
| 1.1-E2E-005 | E2E | P2 | Navigate backward through form steps ‚Üí data preserved | Multi-step UX |

**Coverage**: 14 tests (3 variations: happy path, validation, edge cases)

---

### AC3: Project Editing and Updates

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 1.1-UNIT-008 | Unit | P1 | Check if project data has changed (isDirty detection) | Utility function |
| 1.1-INT-011 | Integration | P0 | Update project title ‚Üí persists to database | Core CRUD operation |
| 1.1-INT-012 | Integration | P0 | Update multiple fields ‚Üí all changes saved | Batch update integrity |
| 1.1-INT-013 | Integration | P1 | Update optional field to null ‚Üí saves correctly | Null handling |
| 1.1-INT-014 | Integration | P1 | Edit validation prevents invalid updates | Update validation |
| 1.1-INT-015 | Integration | P2 | Updated_at timestamp updates on save | Audit trail |
| 1.1-E2E-006 | E2E | P1 | Edit project ‚Üí save ‚Üí changes reflected on card | Edit workflow |
| 1.1-E2E-007 | E2E | P2 | Edit project ‚Üí cancel ‚Üí no changes saved | Cancel behavior |

**Coverage**: 8 tests (CRUD update operations)

---

### AC4: Staff Assignment to Projects

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 1.1-UNIT-009 | Unit | P0 | Calculate working days from date range | Date calculation logic |
| 1.1-UNIT-010 | Unit | P0 | Validate staff ID exists before assignment | Validation logic |
| 1.1-INT-016 | Integration | P0 | Add staff to project ‚Üí project_staff record created | Core staffing operation |
| 1.1-INT-017 | Integration | P0 | Add staff with working dates ‚Üí dates saved correctly | Date handling |
| 1.1-INT-018 | Integration | P0 | Add staff ‚Üí project.filled_positions increments | Counter update |
| 1.1-INT-019 | Integration | P1 | Add staff with daily salaries ‚Üí salaries persisted | Financial data |
| 1.1-INT-020 | Integration | P1 | Remove staff ‚Üí project_staff record deleted | CRUD delete |
| 1.1-INT-021 | Integration | P1 | Remove staff ‚Üí project.filled_positions decrements | Counter update |
| 1.1-INT-022 | Integration | P2 | Add same staff twice ‚Üí validation prevents duplicate | Duplicate prevention |
| 1.1-E2E-008 | E2E | P0 | Search staff ‚Üí select ‚Üí add to project ‚Üí appears in list | Staff assignment journey |
| 1.1-E2E-009 | E2E | P1 | Add staff with specific dates ‚Üí calendar saves correctly | Date selection UX |

**Coverage**: 11 tests (staff CRUD + calculations)

---

### AC5: Staff Status Management

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 1.1-UNIT-011 | Unit | P1 | Validate status enum values | Enum validation |
| 1.1-INT-023 | Integration | P0 | Change status Pending ‚Üí Confirmed ‚Üí updates DB | Status transition |
| 1.1-INT-024 | Integration | P0 | Confirmed staff increments filled_positions | Business logic |
| 1.1-INT-025 | Integration | P1 | Rejected staff doesn't count in filled_positions | Business logic |
| 1.1-INT-026 | Integration | P1 | Bulk status update ‚Üí all records updated | Batch operation |
| 1.1-E2E-010 | E2E | P1 | Change status dropdown ‚Üí staff moves to correct section | Status management UX |
| 1.1-E2E-011 | E2E | P2 | Confirm multiple applicants ‚Üí all move to Confirmed list | Bulk UX |

**Coverage**: 7 tests (status transitions + UI movement)

---

### AC6: Staff Replacement Functionality

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 1.1-INT-027 | Integration | P1 | Create replacement ‚Üí original staff marked as replaced | Replacement logic |
| 1.1-INT-028 | Integration | P1 | Replacement inherits working dates from original | Date inheritance |
| 1.1-INT-029 | Integration | P1 | Replacement reason saved to database | Audit trail |
| 1.1-INT-030 | Integration | P2 | Replacement doesn't affect filled_positions count | Business rule |
| 1.1-E2E-012 | E2E | P2 | Replace staff workflow ‚Üí replacement appears with badge | Replacement journey |

**Coverage**: 5 tests (replacement feature)

---

### AC7: Payroll Management

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 1.1-UNIT-012 | Unit | P0 | Calculate total payroll = sum(staff totals) | Financial calculation |
| 1.1-UNIT-013 | Unit | P0 | Calculate staff total = daily_rate √ó days_worked | Financial calculation |
| 1.1-UNIT-014 | Unit | P0 | Format currency display (e.g., $1,234.56) | Formatter |
| 1.1-UNIT-015 | Unit | P0 | Parse currency string to number | Parser |
| 1.1-INT-031 | Integration | P0 | Save payroll data ‚Üí persists to database | Financial data integrity |
| 1.1-INT-032 | Integration | P0 | Update staff salary ‚Üí recalculates total payroll | Calculation update |
| 1.1-INT-033 | Integration | P1 | Payroll with missing salaries ‚Üí validation error | Data validation |
| 1.1-E2E-013 | E2E | P0 | Edit salary ‚Üí total updates ‚Üí save ‚Üí persists | Payroll management journey |

**Coverage**: 8 tests (critical financial calculations)

---

### AC8: Document Management

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 1.1-UNIT-016 | Unit | P1 | Detect file type from extension | File type detection |
| 1.1-UNIT-017 | Unit | P1 | Validate file size < 10MB | File validation |
| 1.1-UNIT-018 | Unit | P1 | Format file size display (MB, KB) | Formatter |
| 1.1-INT-034 | Integration | P0 | Upload document ‚Üí saved to Supabase storage | File upload operation |
| 1.1-INT-035 | Integration | P0 | Upload document ‚Üí metadata saved to DB | Document record creation |
| 1.1-INT-036 | Integration | P1 | Download document ‚Üí correct file retrieved | File retrieval |
| 1.1-INT-037 | Integration | P1 | Delete document ‚Üí removed from storage and DB | CRUD delete |
| 1.1-INT-038 | Integration | P2 | Add external link ‚Üí saved as document record | Link handling |
| 1.1-E2E-014 | E2E | P1 | Upload PDF ‚Üí appears in list ‚Üí download works | Document workflow |
| 1.1-E2E-015 | E2E | P2 | Upload oversized file ‚Üí error message shown | Error handling UX |

**Coverage**: 10 tests (file operations + validation)

---

### AC9: Project Export Functionality

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 1.1-UNIT-019 | Unit | P1 | Format project data for CSV export | Data transformation |
| 1.1-UNIT-020 | Unit | P1 | Format project data for Excel export | Data transformation |
| 1.1-INT-039 | Integration | P1 | Generate CSV export ‚Üí contains correct data | Export generation |
| 1.1-INT-040 | Integration | P1 | Generate Excel export ‚Üí multi-sheet structure | Export generation |
| 1.1-INT-041 | Integration | P2 | Export includes staff list | Data inclusion |
| 1.1-INT-042 | Integration | P2 | Export includes financial summary | Data inclusion |
| 1.1-E2E-016 | E2E | P1 | Click Export ‚Üí select CSV ‚Üí file downloads | Export workflow |

**Coverage**: 7 tests (export formats)

---

### AC10: Invoice Generation

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 1.1-UNIT-021 | Unit | P0 | Calculate invoice total = payroll + overhead | Financial calculation |
| 1.1-UNIT-022 | Unit | P0 | Generate invoice number (if auto-generate) | ID generation logic |
| 1.1-INT-043 | Integration | P0 | Generate invoice ‚Üí PDF created | Revenue-critical operation |
| 1.1-INT-044 | Integration | P0 | Invoice includes correct line items and totals | Invoice accuracy |
| 1.1-INT-045 | Integration | P0 | Invoice saved to project_documents | Audit trail |
| 1.1-E2E-017 | E2E | P0 | Generate invoice ‚Üí preview ‚Üí download PDF | Invoice generation journey |

**Coverage**: 6 tests (critical invoicing)

---

### AC11: Project Status Management

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 1.1-UNIT-023 | Unit | P1 | Validate status enum values | Validation logic |
| 1.1-INT-046 | Integration | P1 | Update project status ‚Üí persists to DB | Status update |
| 1.1-INT-047 | Integration | P1 | Mark as Completed ‚Üí completion_date recorded | Audit trail |
| 1.1-INT-048 | Integration | P2 | Completed project ‚Üí optional lock on editing | Business rule |
| 1.1-E2E-018 | E2E | P1 | Change status ‚Üí card moves to correct filter section | Status UX |

**Coverage**: 5 tests (status lifecycle)

---

### AC12: Search and Filter Projects

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 1.1-UNIT-024 | Unit | P2 | Filter projects by status (pure function) | Filter logic |
| 1.1-UNIT-025 | Unit | P2 | Search projects by title (fuzzy match) | Search algorithm |
| 1.1-UNIT-026 | Unit | P2 | Combine multiple filters (AND logic) | Filter combination |
| 1.1-INT-049 | Integration | P2 | Search query ‚Üí returns matching projects from DB | DB query |
| 1.1-INT-050 | Integration | P2 | Filter by month ‚Üí returns projects in date range | Date filtering |
| 1.1-E2E-019 | E2E | P2 | Type in search ‚Üí results filter in real-time | Search UX |

**Coverage**: 6 tests (search/filter functionality)

---

### AC13: Schedule Conflict Detection

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 1.1-UNIT-027 | Unit | P1 | Detect date overlap between two ranges | Date logic |
| 1.1-UNIT-028 | Unit | P1 | No overlap returns false | Edge case |
| 1.1-INT-051 | Integration | P1 | Add staff with conflict ‚Üí warning displayed | Conflict detection |
| 1.1-INT-052 | Integration | P1 | Override conflict ‚Üí logged in database | Conflict logging |
| 1.1-E2E-020 | E2E | P1 | Assign conflicted staff ‚Üí warning shown ‚Üí can override | Conflict workflow |

**Coverage**: 5 tests (conflict detection)

---

### AC14: Responsive Design & Mobile Access

**Note**: Responsive design is primarily visual and best tested manually or with visual regression testing tools.

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 1.1-INT-053 | Integration | P3 | Component renders on mobile viewport (375px) | Responsive rendering |
| 1.1-INT-054 | Integration | P3 | Component renders on tablet viewport (768px) | Responsive rendering |
| 1.1-INT-055 | Integration | P3 | Component renders on desktop viewport (1920px) | Responsive rendering |

**Manual Testing Required**:
- Touch interactions on mobile
- Swipe gestures
- Hamburger menu functionality
- Form field sizing and usability

**Coverage**: 3 automated tests + extensive manual testing

---

### AC15: Error Handling & Data Integrity

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 1.1-INT-056 | Integration | P0 | Database connection fails ‚Üí error handled gracefully | Error handling |
| 1.1-INT-057 | Integration | P0 | Network timeout ‚Üí displays timeout message | Error handling |
| 1.1-INT-058 | Integration | P1 | Form submission error ‚Üí data preserved | Data integrity |
| 1.1-INT-059 | Integration | P1 | Duplicate submission prevented via loading state | Race condition prevention |
| 1.1-INT-060 | Integration | P2 | Error logged to console/monitoring service | Error tracking |

**Coverage**: 5 tests (error scenarios)

---

## Risk Coverage

### Revenue Risks (P0)
- ‚úÖ **RISK-001**: Incorrect payroll calculations ‚Üí Covered by 1.1-UNIT-012, 1.1-UNIT-013, 1.1-INT-031, 1.1-E2E-013
- ‚úÖ **RISK-002**: Invoice generation errors ‚Üí Covered by 1.1-UNIT-021, 1.1-INT-043, 1.1-INT-044, 1.1-E2E-017
- ‚úÖ **RISK-003**: Data loss during operations ‚Üí Covered by 1.1-INT-056, 1.1-INT-058

### Data Integrity Risks (P0)
- ‚úÖ **RISK-004**: Project creation fails ‚Üí Covered by 1.1-INT-005, 1.1-E2E-003
- ‚úÖ **RISK-005**: Staff assignment corruption ‚Üí Covered by 1.1-INT-016, 1.1-INT-018, 1.1-E2E-008
- ‚úÖ **RISK-006**: Document upload failures ‚Üí Covered by 1.1-INT-034, 1.1-INT-035, 1.1-E2E-014

### Security Risks (P0)
- ‚úÖ **RISK-007**: Unauthorized access ‚Üí Covered by 1.1-INT-001, 1.1-INT-002, 1.1-E2E-001

---

## Recommended Execution Order

### Phase 1: Critical Path (P0) - Must Pass
1. **Authentication Tests** (1.1-INT-001, 1.1-INT-002, 1.1-E2E-001)
2. **Project CRUD** (1.1-INT-005, 1.1-E2E-003)
3. **Staff Assignment** (1.1-INT-016, 1.1-E2E-008)
4. **Payroll Calculations** (1.1-UNIT-012, 1.1-UNIT-013, 1.1-INT-031, 1.1-E2E-013)
5. **Invoice Generation** (1.1-UNIT-021, 1.1-INT-043, 1.1-E2E-017)
6. **Document Upload** (1.1-INT-034, 1.1-E2E-014)
7. **Error Handling** (1.1-INT-056, 1.1-INT-057)

**Total P0**: 35 tests (must have 100% pass rate)

---

### Phase 2: Core Functionality (P1)
1. **Form Validation** (1.1-UNIT-003 through 1.1-UNIT-006)
2. **Project Editing** (1.1-INT-011, 1.1-INT-012, 1.1-E2E-006)
3. **Staff Status Management** (1.1-INT-023, 1.1-INT-024, 1.1-E2E-010)
4. **Export Functionality** (1.1-INT-039, 1.1-INT-040, 1.1-E2E-016)
5. **Conflict Detection** (1.1-UNIT-027, 1.1-INT-051, 1.1-E2E-020)

**Total P1**: 32 tests (target 95% pass rate)

---

### Phase 3: Secondary Features (P2)
1. **Staff Replacement** (1.1-INT-027 through 1.1-E2E-012)
2. **Search & Filter** (1.1-UNIT-024 through 1.1-E2E-019)
3. **Optional Field Handling** (1.1-INT-010, 1.1-INT-013)

**Total P2**: 18 tests (target 80% pass rate)

---

### Phase 4: Polish & Edge Cases (P3)
1. **Responsive Design** (1.1-INT-053 through 1.1-INT-055)
2. **Error Logging** (1.1-INT-060)

**Total P3**: 4 tests (manual testing acceptable)

---

## Test Automation Strategy

### Unit Tests (28 tests)
- **Framework**: Jest + React Testing Library
- **Location**: `src/__tests__/unit/`
- **Execution**: Every commit (< 30 seconds total)
- **Coverage Target**: 80%+

**Example**:
```javascript
// File: calculatePayroll.test.ts
test('calculateTotalPayroll sums all staff salaries', () => {
  const staff = [
    { daily_rate: 100, days: 5 },
    { daily_rate: 150, days: 3 }
  ];
  expect(calculateTotalPayroll(staff)).toBe(950);
});
```

---

### Integration Tests (41 tests)
- **Framework**: Jest + Supabase Test Client
- **Location**: `src/__tests__/integration/`
- **Execution**: Every PR (< 2 minutes total)
- **Database**: Test Supabase project or local PostgreSQL

**Example**:
```javascript
// File: projectCreation.integration.test.ts
test('Create project saves to database', async () => {
  const projectData = {
    title: 'Test Project',
    client_id: 'test-client-123',
    manager_id: 'test-manager-456'
  };

  const { data, error } = await supabase
    .from('projects')
    .insert(projectData)
    .select();

  expect(error).toBeNull();
  expect(data[0].title).toBe('Test Project');
});
```

---

### E2E Tests (20 tests)
- **Framework**: Playwright or Cypress
- **Location**: `e2e/`
- **Execution**: Nightly + before releases (< 10 minutes total)
- **Environment**: Staging environment with test data

**Example**:
```javascript
// File: projectWorkflow.e2e.spec.ts
test('Complete project creation journey', async ({ page }) => {
  await page.goto('/projects');
  await page.click('button:has-text("New Project")');

  // Fill project info step
  await page.fill('[name="title"]', 'Summer Festival 2025');
  await page.selectOption('[name="client_id"]', 'ABC Corp');
  await page.click('button:has-text("Next")');

  // ... continue through all steps ...

  await page.click('button:has-text("Create Project")');

  // Verify project appears
  await expect(page.locator('text=Summer Festival 2025')).toBeVisible();
});
```

---

## Quality Gate Criteria

### Must Pass (Blocking)
- ‚úÖ All 35 P0 tests pass (100%)
- ‚úÖ No P0 bugs in code review
- ‚úÖ Code coverage ‚â• 80% for business logic

### Should Pass (Warning)
- ‚ö†Ô∏è ‚â• 95% of P1 tests pass
- ‚ö†Ô∏è No new P1 bugs introduced
- ‚ö†Ô∏è Performance benchmarks met

### Nice to Have
- üîµ ‚â• 80% of P2 tests pass
- üîµ P3 tests executed manually

---

## Manual Testing Checklist

Even with automation, some scenarios require manual verification:

- [ ] Visual inspection of project cards on various screen sizes
- [ ] Touch interactions on mobile devices (real devices, not just emulator)
- [ ] File upload progress indicators
- [ ] PDF invoice formatting and printability
- [ ] Accessibility (keyboard navigation, screen reader)
- [ ] Browser compatibility (Chrome, Firefox, Safari, Edge)
- [ ] Loading states and animations
- [ ] Error toast messages appearance and timing

---

## Test Data Requirements

### Test Users
- `test-pm@example.com` - Project Manager role
- `test-admin@example.com` - Admin role

### Test Companies
- ABC Corporation (id: test-company-001)
- XYZ Events (id: test-company-002)

### Test Candidates
- John Doe (id: test-candidate-001)
- Jane Smith (id: test-candidate-002)
- Mike Johnson (id: test-candidate-003)

### Test Projects
- "Summer Festival 2025" - Planning status
- "Winter Gala 2024" - Completed status

---

## Success Criteria

This test design is successful if:
- ‚úÖ All 15 acceptance criteria have test coverage
- ‚úÖ Critical risks (revenue, data integrity, security) are covered
- ‚úÖ Test execution completes within time budgets
- ‚úÖ Tests are maintainable and clearly documented
- ‚úÖ Both automated and manual testing strategies defined

---

## Next Steps

1. **Implement Unit Tests**: Start with financial calculations (P0)
2. **Implement Integration Tests**: Focus on CRUD operations (P0)
3. **Implement E2E Tests**: Cover critical user journeys (P0)
4. **Create Test Data Fixtures**: Prepare test database
5. **Set Up CI/CD Pipeline**: Automate test execution
6. **Create User Guide**: Document manual testing scenarios with screenshots

---

## Quality Gate YAML Block

```yaml
test_design:
  story_id: "1.1"
  scenarios_total: 89
  by_level:
    unit: 28
    integration: 41
    e2e: 20
  by_priority:
    p0: 35
    p1: 32
    p2: 18
    p3: 4
  coverage_gaps: []
  risks_covered:
    - RISK-001: Incorrect payroll calculations
    - RISK-002: Invoice generation errors
    - RISK-003: Data loss during operations
    - RISK-004: Project creation fails
    - RISK-005: Staff assignment corruption
    - RISK-006: Document upload failures
    - RISK-007: Unauthorized access
  execution_estimate:
    unit_tests: "30 seconds"
    integration_tests: "2 minutes"
    e2e_tests: "10 minutes"
    manual_testing: "2 hours"
```

---

## Trace References

Test design matrix: `qa/assessments/1.1-test-design-20251004.md`
P0 tests identified: 35
P1 tests identified: 32
Total automated tests: 89
Manual test scenarios: 10+

---

**Document Version:** 1.0
**Last Updated:** 2025-10-04
**Owner:** Quinn (Test Architect)
**Status:** ‚úÖ Complete - Ready for Implementation
